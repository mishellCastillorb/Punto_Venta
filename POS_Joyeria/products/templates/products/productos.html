{% extends "home/base_pos.html" %}
{% load static %}
{% load roles_tags %}

{% block title %}Productos{% endblock %}

{% block content %}

  <div class="w-full max-w-7xl mx-auto">

    <div class="flex items-start justify-between gap-4 mb-4">
      <div>
        <h1 class="text-2xl font-bold">Productos</h1>
        <p class="text-sm text-gray-500">Gestión de inventario</p>
      </div>

      {% if request.user|in_group:"AdminPOS" %}
        <a href="{% url 'products_web:product_create' %}"
           class="bg-amber-700 hover:bg-amber-800 text-white px-4 py-2 rounded whitespace-nowrap">
          + Nuevo producto
        </a>
      {% endif %}
    </div>

    <!-- Tabs -->
    <div class="flex items-center gap-2 mb-4">
      <a href="{% url 'products_web:categories' %}"
         class="px-4 py-2 rounded border bg-white hover:bg-gray-50">
        Categorías
      </a>
      <a href="{% url 'products_web:materials' %}"
         class="px-4 py-2 rounded border bg-white hover:bg-gray-50">
        Materiales
      </a>
    </div>

    <!-- Tabla -->
    <div class="bg-white shadow rounded overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full w-full text-left text-sm">
          <thead class="bg-gray-200">
            <tr>
              <th class="p-2 w-20">Foto</th>
              <th class="p-2 w-40">Código</th>
              <th class="p-2">Nombre</th>
              <th class="p-2 w-40">Categoría</th>
              <th class="p-2 w-32">Material</th>
              <th class="p-2 w-28">Precio</th>
              <th class="p-2 w-24">Stock</th>
              <th class="p-2 w-28">Acciones</th>
            </tr>
          </thead>

          <tbody>
            {% for p in productos %}
            <tr class="border-b align-middle">
              <td class="p-2">
                {% if p.image %}
                  <img src="{{ p.image.url }}" class="w-12 h-12 object-cover rounded border" alt="{{ p.name }}">
                {% else %}
                  <div class="w-12 h-12 rounded border bg-gray-50 flex items-center justify-center text-gray-400 text-xs">
                    —
                  </div>
                {% endif %}
              </td>

              <td class="p-2 whitespace-nowrap">{{ p.code }}</td>
              <td class="p-2">{{ p.name }}</td>
              <td class="p-2 whitespace-nowrap">{{ p.category }}</td>
              <td class="p-2 whitespace-nowrap">{{ p.material }}</td>
              <td class="p-2 whitespace-nowrap">${{ p.sale_price }}</td>
              <td class="p-2 whitespace-nowrap">{{ p.stock }}</td>

              <td class="p-2">
                {% if request.user|in_group:"AdminPOS" %}
                  <a href="{% url 'products_web:product_edit' p.id %}"
                     class="px-3 py-1 text-sm bg-amber-700 text-white rounded hover:bg-amber-800 whitespace-nowrap inline-block">
                    Editar
                  </a>
<form method="post"
      action="{% url 'products_web:delete' p.id %}"
      onsubmit="return confirm('¿Eliminar este producto?');">
  {% csrf_token %}
  <button class="bg-red-600 text-white px-3 py-1 rounded">
    Eliminar
  </button>
</form>

                {% else %}
                  <span class="text-gray-400 text-xs">—</span>
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" class="p-6 text-center text-gray-500">
                No hay productos registrados
              </td>
            </tr>
            {% endfor %}
          </tbody>

        </table>
      </div>
    </div>

  </div>

{% endblock %}
